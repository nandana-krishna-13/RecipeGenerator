<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet'>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Profile Dashboard</title>
<style>
  :root {
    --first-color: #000000;
    --first-color-dark: #ffcc5c;
    --first-color-darken: #ffcc5c;;
    --white-color: #ff6f69;
    --body-font: 'Poppins', sans-serif;
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: var(--body-font);
    background-color: var(--first-color);
    color: var(--white-color);
    margin: 0;
    padding: 0;
  }

  .container {
    max-width: 900px;
    margin: 2rem auto;
    background: var(--first-color);
    border-radius: 8px;
    box-shadow: 0 0 10px var(--first-color-darken);
    padding: 2rem;
  }

  h1 {
    color: #ffffff;
    margin-bottom: 1rem;
    text-align: center;
  }

  .profile-info {
    display: flex;
    justify-content: space-around;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--first-color-darken);
  }

  .profile-info div {
    text-align: center;
  }

  .profile-info div label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.3rem;
    color: var(--first-color-darken);
  }

  .profile-info div span {
    font-size: 1.1rem;
    color: #ffffff;
    font-weight: 600;
  }

  .tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
  }

  .tab {
    cursor: pointer;
    padding: 0.7rem 1.5rem;
    margin: 0 0.5rem;
    border-radius: 20px;
    background-color: var(--first-color-darken);
    color: var(--first-color);
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
  }

  .tab.active {
    background-color: #ffffff;
    color: var(--first-color-dark);
    box-shadow: 0 0 8px var(--first-color-dark);
  }

  .tab:hover:not(.active) {
    background-color: var(--first-color-dark);
    color: white;
  }

  .tab-content {
    min-height: 200px;
  }

  .recipe-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .recipe-list li {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid var(--first-color-darken);
    font-size: 1rem;
    color: #ffffff;
    font-weight: 600;
  }

  .recipe-list li:last-child {
    border-bottom: none;
  }

  /* Responsive */
  @media (max-width: 600px) {
    .profile-info {
      flex-direction: column;
      gap: 1rem;
    }
    .tabs {
      flex-wrap: wrap;
    }
    .tab {
      margin: 0.3rem 0.3rem;
      flex: 1 1 30%;
      text-align: center;
    }
  }

  .logo-link {
      position: absolute;
      top: 2rem;
      left: 2rem;
      display: inline-block;
      width: 150px;
      height: auto;
      z-index: 1001;
    }
    .logo {
      width: 100%;
      height: auto;
      display: block;
    }


    /* ===== Light Theme Overrides for Profile Page ===== */

body.light-theme {
  background-color: #fff8f0;
  color: #333;
}

body.light-theme .container {
  background-color: #ffffff;
  box-shadow: 0 0 10px rgba(255, 111, 54, 0.2);
  color: #333;
}

body.light-theme h1 {
  color: #ff6f3c;
}

body.light-theme .profile-info div label {
  color: #ff6f3c;
}

body.light-theme .profile-info div span {
  color: #333;
}

body.light-theme .tab {
  background-color: #ffcc5c;
  color: #000;
}

body.light-theme .tab:hover:not(.active) {
  background-color: #ff9a56;
  color: white;
}

body.light-theme .tab.active {
  background-color: #ffffff;
  color: #ff6f3c;
  box-shadow: 0 0 8px #ff6f3c;
}

body.light-theme .recipe-list li {
  border-bottom: 1px solid #f2c98c;
  color: #333;
}

body.light-theme .recipe-list li:last-child {
  border-bottom: none;
}

body.light-theme .tab {
  background-color: #ff9a56; /* light theme base color */
  color: white;
}

/* Base styling (used for both themes) */
.edit-profile-btn {
  padding: 0.5rem 1rem;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  margin-bottom: 1rem;
  border: none;
}

/* Dark theme default */
body:not(.light-theme) .edit-profile-btn {
  background-color: var(--first-color-darken); /* yellow */
  color: var(--first-color);                   /* black */
}

/* Light theme override */
body.light-theme .edit-profile-btn {
  background-color: #ff9a56; /* orange */
  color: white;
}

body.light-theme .edit-profile-btn:hover {
  background-color: #ff8544;
  box-shadow: 0 0 8px #ff6f3c;
}
.logout-btn {
  background: none;
  border: none;
  color: var(--white-color);   /* same accent as other icons/buttons */
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: .25rem;
  transition: color .3s ease;
}
.logout-btn:hover {
  color: var(--first-color-darken); }

</style>
</head>
<body>
  <header>
    <a href="index.html" class="logo-link" aria-label="Home">
      <img id="nav-logo" src="logo_light.png" alt="Logo" class="logo" />
    </a>
    <button id="logoutBtn" class="logout-btn" title="Log out" style="position: absolute; top: 1.5rem; right: 2rem;">
      <i class='bx bx-log-out-circle'></i> Logout
    </button>
  </header>
  <div class="container">
    <h1>Profile Dashboard</h1>
    <section class="profile-info">
      <div>
        <label>Name</label>
    <span id="profile-name">Nandana Krishna</span>
      </div>
      <div>
        <label>Phone Number</label>
    <span id="profile-phone">+1 234 567 890</span>
      </div>
      <div>
        <label>Country</label>
    <span id="profile-country">India</span>
      </div>
    </section>

    <section class="profile-recipes">
      <button id="edit-profile-btn" class="edit-profile-btn">Edit Profile</button>
      <div class="tabs">
        <div class="tab active" data-tab="posted">Posted Recipes</div>
        <div class="tab" data-tab="liked">Liked Recipes</div>
        <div class="tab" data-tab="saved">Saved Recipes</div>
      </div>
      <div class="tab-content" id="tab-content">
        <!-- Recipes will be loaded here -->
      </div>
    </section>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab');
const tabContent = document.getElementById('tab-content');

// This will be filled with real data after fetching
const recipesData = {
  posted: [],
  liked: [],
  saved: []
};

async function fetchUserInfo() {
  const userId = localStorage.getItem('userId');
  if (!userId) return;

  try {
    const res = await fetch(`http://localhost:5000/api/user/${userId}`);
    const user = await res.json();

    // Set user info in profile
    document.getElementById('profile-name').textContent = user.name || 'N/A';
    document.getElementById('profile-phone').textContent = user.phone || 'N/A';
    document.getElementById('profile-country').textContent = user.country || 'N/A';
  } catch (err) {
    console.error('Error fetching user info:', err);
  }
}


// Fetch user data and populate tabs
async function fetchProfileRecipes() {
  const userId = localStorage.getItem('userId'); // must be set at login/signup

  if (!userId) {
    tabContent.innerHTML = '<p>Please log in to view your profile.</p>';
    return;
  }

  try {
    const res = await fetch(`http://localhost:5000/api/interactions/profile/${userId}`);
    const data = await res.json();

    recipesData.posted = data.postedRecipes.map(r => r.title);
    recipesData.liked = data.likedRecipes.map(r => r.title);
    recipesData.saved = data.savedRecipes.map(r => r.title);

    updateTabCounts();
    renderRecipes('posted');
  } catch (err) {
    console.error('❌ Error fetching profile data', err);
    tabContent.innerHTML = '<p>Failed to load recipes. Try again later.</p>';
  }
}

function updateTabCounts() {
  tabs.forEach(tab => {
    const tabKey = tab.dataset.tab;
    const count = recipesData[tabKey]?.length || 0;
    const baseText = tabKey.charAt(0).toUpperCase() + tabKey.slice(1) + ' Recipes';
    tab.textContent = `${baseText} - ${count}`;
  });
}

function renderRecipes(tab) {
  const recipes = recipesData[tab] || [];
  if (recipes.length === 0) {
    tabContent.innerHTML = '<p>No recipes found.</p>';
    return;
  }
  const ul = document.createElement('ul');
  ul.className = 'recipe-list';
  recipes.forEach(recipe => {
    const li = document.createElement('li');
    li.textContent = recipe;
    ul.appendChild(li);
  });
  tabContent.innerHTML = '';
  tabContent.appendChild(ul);
}

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    renderRecipes(tab.dataset.tab);
  });
});

function showStatusMessage(msg, color) {
  let status = document.getElementById('status-message');
  if (!status) {
    status = document.createElement('p');
    status.id = 'status-message';
    status.style.marginTop = '10px';
    status.style.fontWeight = 'bold';
    document.getElementById('edit-profile-btn').insertAdjacentElement('afterend', status);
  }
  status.textContent = msg;
  status.style.color = color;
}


// Edit Profile Logic
const editBtn = document.getElementById('edit-profile-btn');
let editing = false;

editBtn.addEventListener('click', async () => {
  const nameSpan = document.getElementById('profile-name');
  const phoneSpan = document.getElementById('profile-phone');
  const countrySpan = document.getElementById('profile-country');

  if (!editing) {
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.id = 'profile-name-input';
    nameInput.value = nameSpan.textContent;

    const phoneInput = document.createElement('input');
    phoneInput.type = 'text';
    phoneInput.id = 'profile-phone-input';
    phoneInput.value = phoneSpan.textContent;

    const countryInput = document.createElement('input');
    countryInput.type = 'text';
    countryInput.id = 'profile-country-input';
    countryInput.value = countrySpan.textContent;

    nameSpan.replaceWith(nameInput);
    phoneSpan.replaceWith(phoneInput);
    countrySpan.replaceWith(countryInput);

    editBtn.textContent = 'Save Profile';
    editing = true;
  } else {
    const nameInput = document.getElementById('profile-name-input');
    const phoneInput = document.getElementById('profile-phone-input');
    const countryInput = document.getElementById('profile-country-input');

    const name = nameInput.value.trim();
    const phone = phoneInput.value.trim();
    const country = countryInput.value.trim();

    const userId = localStorage.getItem('userId');

    try {
      const res = await fetch(`http://localhost:5000/api/user/edit-profile/${userId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, phone, country })
      });

      const data = await res.json();

      if (res.ok) {
        const newNameSpan = document.createElement('span');
        newNameSpan.id = 'profile-name';
        newNameSpan.textContent = name;

        const newPhoneSpan = document.createElement('span');
        newPhoneSpan.id = 'profile-phone';
        newPhoneSpan.textContent = phone;

        const newCountrySpan = document.createElement('span');
        newCountrySpan.id = 'profile-country';
        newCountrySpan.textContent = country;

        nameInput.replaceWith(newNameSpan);
        phoneInput.replaceWith(newPhoneSpan);
        countryInput.replaceWith(newCountrySpan);

        showStatusMessage('Profile updated successfully ✅', 'green');
        editBtn.textContent = 'Edit Profile';
        editing = false;
      } else {
        showStatusMessage(data.message || 'Update failed ❌', 'red');
      }
    } catch (err) {
      showStatusMessage('Server error while updating ❌', 'red');
    }
  }
});

// Initial Load
fetchProfileRecipes();
fetchUserInfo();

  </script>
  <script src="main.js"></script>
  <script>
    // Logout button handler
    document.getElementById('logoutBtn').addEventListener('click', () => {
      // Clear login state
      localStorage.removeItem('userId');
      localStorage.removeItem('token'); // if you save JWT later
      // Redirect to login page
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
