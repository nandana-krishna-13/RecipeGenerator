<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meal Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --black: #000000;
      --yellow: #EEDF7A;
      --green: #D8A25E;
      --red:#A04747;
      --white: #ffffff;
      --background-gradient: linear-gradient(135deg, #000000 0%, #121212 100%);
      --body-font: "Poppins", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--body-font);
      background: var(--background-gradient);
      color: var(--white);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: var(--black);
      color: var(--yellow);
      padding: 1.5rem 2rem;
      text-align: center;
      font-weight: 700;
      font-size: 2.5rem;
    }

    main {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      padding: 2rem;
      justify-content: center;
    }

    section {
      background: #121212;
      border-radius: 12px;
      padding: 1.5rem 2rem;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      min-width: 260px;
      flex: 1;
    }

    h2 {
      text-align: center;
      color: var(--yellow);
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .dishes-section { flex: 1 1 280px; }
    .planner-section { flex: 2 1 600px; }
    .ingredient-checklist-section {
      flex: 0.5 1 240px;
      max-width: 300px;
      display: none;
      min-height: 600px; /* <- Increased height */
      overflow-y: auto;
    }

    .add-dish {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      border: 2px solid var(--green);
      font-size: 1rem;
    }

    button {
      background: linear-gradient(270deg, #ffcc5c, #81968c, #ffcc5c);
      background-size: 600% 600%;
      color: var(--black);
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      animation: gradientShift 8s ease infinite;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px var(--yellow);
    }

    .dishes-list {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .dish {
      background: var(--green);
      color: var(--black);
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
      cursor: grab;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .delete-btn {
      background: none;
      color: var(--red);
      font-size: 1.2rem;
      border: none;
      cursor: pointer;
    }

    .week-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      width: 100%;
    }

    .day {
      background: var(--green);
      border-radius: 16px;
      padding: 1rem;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .day-header {
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .dropzone {
      background: var(--yellow);
      padding: 0.5rem;
      flex-grow: 1;
      border-radius: 10px;
      overflow-y: auto;
    }

    .meal-item {
      background: var(--black);
      color: var(--yellow);
      padding: 0.6rem 0.9rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .edit-section {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .popup-card {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #444;
      color: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
      flex-direction: column;
      gap: 1rem;
      max-width: 90vw;
    }

    .ingredient-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  max-width: 400px;
}

    /* .ingredient-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1rem;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background-color: #f9f9f9;
} */

 .ingredient-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1rem;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background-color: #f9f9f9;
  color: #000;
}

.ingredient-checkbox {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  accent-color: var(--green); /* optional for native styling */
}

.ingredient-label {
  flex: 1;
  font-weight: 500;
}


    /* .ingredient-item {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    } */

    /* .ingredient-item input[type="checkbox"] {
      margin-right: 0.5rem;
      accent-color: var(--green);
    } */

    @media (max-width: 1024px) {
      main {
        flex-direction: column;
        align-items: stretch;
      }
      .week-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Ingredient Checklist Styling */
#ingredient-checklist {
  background: #fefefe;
  padding: 1rem;
  border-radius: 12px;
  color: var(--black);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  max-height: 600px;
  height:100%;
  overflow-y: auto;
}

.ingredient-item label {
  font-weight: 600;
  font-size: 1rem;
}

    .ingredient-item input[type="checkbox"] {
  /* Size & shape */
  width: 24px;
  height: 24px;
  border-radius: 6px;
  border: 2px solid var(--black);
  background-color: #fff;

  /* Remove default style */
  appearance: none;
  -webkit-appearance: none;
  outline: none;

  /* Transition */
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  margin-right: 0.6rem;
}

/* Custom tick mark using pseudo-element */
.ingredient-item input[type="checkbox"]::before {
  content: \"\";
  position: absolute;
  top: 4px;
  left: 8px;
  width: 5px;
  height: 10px;
  border: solid var(--black);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
  opacity: 0;
  transition: opacity 0.2s ease;
}


    .ingredient-item input[type="checkbox"]:checked {
      background-color: var(--green);
      border-color: var(--green);
    }

    .ingredient-item input[type="checkbox"]:checked::before {
      opacity: 1;
    }

    .ingredient-item input[type="checkbox"]:hover {
      box-shadow: 0 0 8px var(--green);
      border-color: #66bb6a;
    }

    /* Close button for meal items in each day */
    .meal-item {
      position: relative;
    }
    .meal-item .close-dish-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      background: none;
      color: var(--red);
      border: none;
      font-size: 0.9rem;
      width: 18px;
      height: 18px;
      line-height: 18px;
      padding: 0;
      margin: 0;
      cursor: pointer;
      border-radius: 50%;
      transition: transform 0.2s ease;
    }

    .meal-item .close-dish-btn:hover {
      transform: scale(1.3);
      color: #ff3333;
    }

/* Hover effects for dishes and meal items */
.dish:hover, .meal-item:hover {
  box-shadow: 0 0 10px var(--yellow);
  transform: scale(1.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Slightly larger Get Ingredients button */
#get-ingredients-trigger {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 999;
  font-size: 1.1rem;
  padding: 0.8rem 1.6rem;
  border-radius: 12px;
  font-weight: 700;
  color: var(--black);
  background: linear-gradient(270deg, #ffcc5c, #81968c, #ffcc5c);
  background-size: 600% 600%;
  animation: gradientShift 8s ease infinite;
  cursor: pointer;
}
#top-right-video-container {
position: absolute;
top: 1rem;
right: 1rem;
width: 300px;
height: 225px;
box-shadow: 0 4px 8px rgba(0,0,0,0.3);
border-radius: 8px;
overflow: hidden;
z-index: 1000;
background: black;
}
#top-right-video-container video {
width: 100%;
height: 100%;
display: block;
object-fit: cover;
}
  </style>
  <style>
    /* Logo styles */
    .logo-link {
      position: absolute;
      top: 2rem;
      left: 2rem;
      display: inline-block;
      width: 120px;
      height: auto;
      z-index: 1001;
    }
    .logo {
      width: 150%;
      height: auto;
      display: block;
    }
    /* Removed logo-light and logo-dark display toggling CSS */
  </style>
  <style>
    .header-title {
      display: inline-block;
      color: var(--yellow);
      font-weight: 700;
      font-size: 2.5rem;
      margin-left: 140px; /* to avoid overlap with logo */
      line-height: 3rem;
      vertical-align: middle;
    }
  </style>
  <style>
    /* ===== Light Theme Overrides for Meal Planner ===== */

body.light-theme {
  background: linear-gradient(135deg, #fff8f0 0%, #f5f5f5 100%);
  color: #333;
}

body.light-theme header {
  background-color: #fff8f0;
  color: #ff6f3c;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

body.light-theme .header-title {
  color: #ff6f3c;
}

body.light-theme section {
  background: #ffffff;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
  color: #333;
}

body.light-theme h2 {
  color: #ff6f3c;
}

body.light-theme input[type="text"] {
  background-color: #ffffff;
  color: #333;
  border: 2px solid #ff9a56;
}

body.light-theme button {
  background: linear-gradient(270deg, #ff9a56, #ffc085, #ff9a56);
  color: white;
}

body.light-theme button:hover {
  box-shadow: 0 0 12px #ff9a56;
}

body.light-theme .dish {
  background-color: #ffe3c4;
  color: #333;
}

body.light-theme .delete-btn {
  color: #cc4444;
}

body.light-theme .day {
  background-color: #ffe3c4;
}

body.light-theme .dropzone {
  background-color: #fff8f0;
}

body.light-theme .meal-item {
  background-color: #fcd8c2;
  color: #333;
}

body.light-theme .popup-card {
  background-color: #ffffff;
  color: #333;
}

body.light-theme #ingredient-checklist {
  background-color: #fefefe;
  color: #333;
}

body.light-theme .ingredient-item {
  background-color: #fff;
  border: 1px solid #ddd;
  color: #333;
}

body.light-theme .ingredient-item input[type="checkbox"] {
  border: 2px solid #333;
}

body.light-theme .ingredient-item input[type="checkbox"]::before {
  border-color: #333;
}

body.light-theme .ingredient-item input[type="checkbox"]:checked {
  background-color: #ff9a56;
  border-color: #ff9a56;
}

body.light-theme .ingredient-item input[type="checkbox"]:hover {
  box-shadow: 0 0 8px #ff9a56;
  border-color: #ff6f3c;
}

body.light-theme .meal-item .close-dish-btn {
  color: #cc4444;
}

body.light-theme .meal-item .close-dish-btn:hover {
  color: #ff4444;
}

body.light-theme #get-ingredients-trigger {
  background: linear-gradient(270deg, #ff9a56, #ffc085, #ff9a56);
  color: white;
}

body.light-theme #top-right-video-container {
  background-color: #000;
}

/* Optional: Light theme scrollbar */
body.light-theme ::-webkit-scrollbar-thumb {
  background-color: #ccc;
}
body.light-theme ::-webkit-scrollbar-track {
  background-color: #eee;
}
body.light-theme #typing-text {
  color: #ff6f3c !important; /* or any other color for light theme */
}


  </style>
</head>


<body>
  <header>
    <a href="index.html" class="logo-link" aria-label="Home">
      <img id="nav-logo" src="logo_light.png" alt="Logo" class="logo" />
    </a>
    <h1 class="header-title">Weekly Meal Map</h1>
  </header>
  <div id="typing-text" style="color: var(--yellow); text-align: center; font-size: 1.2rem; margin-top: 0.5rem; height: 1.5rem;"></div>
  <!-- <div id="top-right-video-container">
    <video autoplay loop muted playsinline>
    <source src="burger.mp4" type="video/mp4" />
    Your browser does not support the video tag.
    </video>
    </div> -->
  <main>
    <section class="dishes-section">
      <h2>Dishes</h2>
      <div class="add-dish">
        <input type="text" id="new-dish-input" placeholder="Add a new dish" />
        <button id="add-dish-button">Add Dish</button>
      </div>
      <div class="dishes-list" id="dishes-list"></div>
    </section>
    <section class="planner-section">
      <h2>Your Meal Plan</h2>
      <div class="week-grid" id="week-grid"></div>
    </section>
    <section class="ingredient-checklist-section" id="ingredient-checklist-section">
      <h2>Ingredient Checklist</h2>
      <div id="ingredient-checklist"></div>
    </section>
    <div class="popup-card" id="popup-card">
      <h3>Enter Dish Name</h3>
      <input type="text" id="popup-dish-name" placeholder="e.g. Pancakes" />
      <button id="generate-checklist-btn">Generate Checklist</button>
      <button onclick="document.getElementById('popup-card').style.display='none'">Close</button>
    </div>
  </main>
  <button id="get-ingredients-trigger" onclick="document.getElementById('popup-card').style.display='flex'" style="position:fixed;bottom:20px;right:20px;z-index:999;">Get Ingredients</button>

  <script>
  const userId = localStorage.getItem('userId');

  const dishIngredientsMap = {
    "Pancakes": ["Flour", "Eggs", "Milk"],
    "Omelette": ["Eggs", "Salt", "Butter"],
    "Grilled Chicken": ["Chicken", "Salt", "Pepper"]
  };

  const checklistSection = document.getElementById('ingredient-checklist-section');
  const checklist = document.getElementById('ingredient-checklist');
  const popupCard = document.getElementById('popup-card');

  document.getElementById('generate-checklist-btn').onclick = async () => {
  const dishName = document.getElementById('popup-dish-name').value.trim();
  if (!dishName) return;

  try {
    const res = await fetch(`http://localhost:5000/api/ingredients/${dishName}`);
    const data = await res.json();

    if (!data.ingredients || !data.ingredients.length) {
      checklist.innerHTML = '<p>No ingredients found.</p>';
      return;
    }

    renderIngredients(data.ingredients);


    checklistSection.style.display = 'flex';
    popupCard.style.display = 'none';

  } catch (err) {
    console.error('Error:', err);
    alert('Could not fetch ingredients.');
  }
};


  // Add dish logic
  const dishes = ["Pancakes", "Omelette", "Grilled Chicken"];
  const dishesList = document.getElementById('dishes-list');
  dishes.forEach(name => addDish(name));

  function addDish(name) {
    const div = document.createElement('div');
    div.className = 'dish';
    div.textContent = name;
    const btn = document.createElement('button');
    btn.className = 'delete-btn';
    btn.textContent = '✕';
    btn.onclick = () => div.remove();
    div.appendChild(btn);
    div.draggable = true;
    div.addEventListener('dragstart', e => dragged = div);
    dishesList.appendChild(div);
  }

  document.getElementById('add-dish-button').onclick = () => {
    const val = document.getElementById('new-dish-input').value.trim();
    if (val) addDish(val);
  };

  let dragged = null;
  const weekGrid = document.getElementById('week-grid');
  ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(day => {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    const header = document.createElement('div');
    header.className = 'day-header';
    header.textContent = day;
    const zone = document.createElement('div');
    zone.className = 'dropzone';
    zone.ondragover = e => e.preventDefault();
    zone.ondrop = async e => {
  e.preventDefault();
  if (dragged) {
    const meal = document.createElement('div');
    meal.className = 'meal-item';
    meal.textContent = dragged.textContent.replace('✕', '').trim();

    const closeBtn = document.createElement('button');
    closeBtn.className = 'close-dish-btn';
    closeBtn.textContent = '✕';
    closeBtn.title = 'Remove dish';
    closeBtn.addEventListener('click', async () => {
      meal.remove();
      await saveMealPlan(); // Save on delete
    });

    meal.appendChild(closeBtn);
    zone.appendChild(meal);

    await saveMealPlan(); // Save on drop
  }
};

    dayDiv.appendChild(header);
    dayDiv.appendChild(zone);
    weekGrid.appendChild(dayDiv);
  });

  async function saveMealPlan() {
  const week = {};
  document.querySelectorAll('.day').forEach(dayDiv => {
    const day = dayDiv.querySelector('.day-header').textContent;
    const dishes = Array.from(dayDiv.querySelectorAll('.meal-item')).map(el => el.childNodes[0].nodeValue.trim());
    week[day] = dishes;
  });

  await fetch('http://localhost:5000/api/meals/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userId, week })
  });
}

  </script>
  <script>
    // Typing animation for the text below the header
    const text = "Plan your perfect week—just drag and drop dishes into each day!";
    const typingTextElem = document.getElementById('typing-text');
    let index = 0;
  
    function type() {
      if (index < text.length) {
        typingTextElem.textContent += text.charAt(index);
        index++;
        setTimeout(type, 50);
      }
    }
  
    // Clear text and start typing animation on page load
    window.onload = async () => {
  typingTextElem.textContent = "";
  index = 0;
  type();

  const res = await fetch(`http://localhost:5000/api/meals/${userId}`);
  const week = await res.json();

  if (week) {
    document.querySelectorAll('.day').forEach(dayDiv => {
      const day = dayDiv.querySelector('.day-header').textContent;
      const zone = dayDiv.querySelector('.dropzone');
      (week[day] || []).forEach(dish => {
        const meal = document.createElement('div');
        meal.className = 'meal-item';
        meal.textContent = dish;

        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-dish-btn';
        closeBtn.textContent = '✕';
        closeBtn.title = 'Remove dish';
        closeBtn.addEventListener('click', async () => {
          meal.remove();
          await saveMealPlan();
        });

        meal.appendChild(closeBtn);
        zone.appendChild(meal);
      });
    });
  }
};

const renderIngredients = (ingredients) => {
  const listContainer = document.getElementById('ingredient-checklist');
  listContainer.innerHTML = '';

  const quantityRegex = /^\s*(\d+|\d+\s?\/\d+|\d+\.\d+|pinch|dash|few|some|to taste)/i;

  ingredients.forEach(item => {
    const wrapper = document.createElement('div');
    wrapper.className = 'ingredient-item';

    const isIngredient = quantityRegex.test(item);

    if (isIngredient) {
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'ingredient-checkbox'; // for consistent styling

      const label = document.createElement('label');
      label.textContent = item;
      label.className = 'ingredient-label';

      wrapper.appendChild(checkbox);
      wrapper.appendChild(label);
    } else {
      const label = document.createElement('label');
      label.textContent = item;
      label.style.fontWeight = '600';
      wrapper.appendChild(label);
    }

    listContainer.appendChild(wrapper);
  });
};

  </script>
  <script src="main.js"></script>
  
</body>
</html>